---
- name: Install epel
  yum:
     name: epel-release
     state: present   

# tasks file for nginx-php
- name: Install nginx
  yum: 
    state: present 
    name: nginx

- name: install php
  include_tasks: 'install-php.yml'
  when: nginx_install_php and not nginx_php_ius and not nginx_php_remi

- name: install php ius
  include_tasks: 'install-php-ius.yml'
  when: nginx_install_php and nginx_php_ius and not nginx_php_remi

- name: install php remi
  include_tasks: 'install-php-remi.yml'
  when: nginx_install_php and nginx_php_remi and not nginx_php_ius

- name: configure nginx.conf
  template:
    src: templates/nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    force: true
    owner: root
    group: root
    mode: 0644
  with_items: "{{ nginx_default }}"

- name: configure vhosts
  include_tasks: 'configure-vhosts.yml'
  when: nginx_vhosts is defined

- name: service nginx
  service:
    name: nginx
    state: restarted
    enabled: yes  

- name: disable selinux
  selinux:
    state: disabled

- name: Install firewalld
  yum: 
    state: present 
    name: firewalld

- name: Enable and start firewalld
  service: 
    name: firewalld 
    state: started 
    enabled: yes

- name: enable firewall ports
  firewalld:
    port: "{{ item }}"
    permanent: true
    state: enabled  
  notify: restarted firewalld   
  with_items: 
    "{{ nginx_firewall_ports }}"